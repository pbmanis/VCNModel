Workflow for vcnmodel simulations
=================================

Last update: 14 June 2022 pbm

If you have not already done so, please read the documents in the "docs" directory (you can build the documentation with sphinx). See the README.md
file for instructions. These documents explain the usage of the scripts and programs in this repository.

The file *"wheres_my_data.toml"* holds the paths to the data. You should modify this file so that the *baseDirectory* points to the location
where you wish to store (and retrieve) results. 

Before you begin, you should also download the basic data directory, which holds the swc and hoc files for the reconstructed cells, and establishes a directory structure for each cell's simulation results. This file is on figshare and is accessible at https://doi.org/10.6084/m9.figshare.19520041.v1. The file is about 2.8GB, and will expand up to around 5.8GB. It includes most of the basic simulations, but does NOT include the SAM simulations, which are quite large. Summary data for the SAM simulations is included however. 

Running simulations
-------------------

Simulations are controlled by shell scripts in the *scripts* subdirectory. These scripts set up the parameters for the
runs, including the cnmodel data tables and various stimulus parameters. The results are stored on a by-cell basis in
the target directory as "VCN-SBEM-Data/VCN_Cells/VCN_Cnm/IV (or AN)" with a long filename. The scripts invoke
*model_run2.py*, which handles all of the simulations and "experiments", and is in turn a wrapper around *cnmodel*. The scripts include a section that initalizes the model and stores that initialization to disk for subsequent use. The resulting data files contain
all of the information regarding the model run, as stored in the dataclasses Params and RunInfo (there should be no
control parameters that are not described in these tables). This includes the full text of the "data\_table" that is
used to control cell decoration of channels in cnmodel.

Analyzing Simulations
---------------------

Analysis is almost entirely handled through "DataTablesVCN.py", which has a graphical interface. This program is described in more detail in the documentation. This program expects you to understand what it does, and so sometimes it does nothing, or prints out some error messages. We also can almost guarantee that certain parts of the program which have not been used recently and which are not needed to regenerate the figures in the paper are broken.

Figures
-------

Most of the figures should be able to be regenerated by selecting the Figure from the drop-down list, and then pressing "create figure". If the figure does not appear on the screen, check to see if it was written to disk instead. 

For some figures, the data to be plotted is collected manually using the "print file info" button in *DataTablesVCN*, under
the Tools bar. The results of the analysis or the files selected are printed into the lower "reporting" window on the
right, where they may be copied out to the appropriate tables in either "vcnmodel/plotting/figure_data.py" or
"vs_datasets.py". 

For a few figures, a specific Python script is used to generate the figure. These scripts can be found in the *analyzers*
and the *plotters* subdirectories.

Most of the figure files are sent in PDF format to the "VCN-SBEM-Data/Figures" directory as both PDF and PNG files.
for some of the simulation figures (Figure 3, lower panels of Figure 8), these files are reassembled in Illustrator 
with other parts of the figure to generate the main figures


